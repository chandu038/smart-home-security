<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Smart Home Security</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        box-sizing: border-box;
        font-family: "Poppins", sans-serif;
      }
      body {
        background: linear-gradient(135deg, #0f172a, #1e293b, #0ea5e9);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
      }
      .container {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(25px);
        padding: 50px 70px;
        border-radius: 28px;
        width: 90%;
        max-width: 1000px;
        text-align: center;
      }
      h1 {
        font-size: 2.6rem;
        background: linear-gradient(135deg, #0ea5e9, #06b6d4);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      .subtitle {
        color: #cbd5e1;
        margin-bottom: 35px;
      }
      .options {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin-bottom: 25px;
      }
      .options label {
        cursor: pointer;
        font-weight: 500;
      }
      #nameBox {
        display: none;
        margin-bottom: 20px;
      }
      #nameBox input {
        width: 60%;
        padding: 12px;
        border-radius: 10px;
        border: none;
        outline: none;
      }
      .upload-area {
        border: 2px dashed rgba(14, 165, 233, 0.6);
        border-radius: 20px;
        padding: 50px 30px;
        cursor: pointer;
        margin-bottom: 25px;
      }
      .upload-area i {
        font-size: 3.5rem;
        color: #0ea5e9;
        margin-bottom: 15px;
      }
      #uploadText {
        margin-bottom: 5px;
      }
      input[type="file"] {
        display: none;
      }
      button {
        padding: 16px 45px;
        border-radius: 50px;
        border: none;
        background: linear-gradient(135deg, #0ea5e9, #06b6d4);
        color: white;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
      }
      .preview {
        margin-top: 25px;
      }
      .preview img {
        width: 100%;
        max-width: 500px;
        border-radius: 16px;
        border: 2px solid rgba(255, 255, 255, 0.2);
      }
      .alert {
        width: 100%;
        max-width: 600px;
        margin: 30px auto 20px auto;
        padding: 16px 24px;
        border-radius: 50px;
        font-weight: 600;
        font-size: 1.1rem;
        display: none;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        animation: fadeIn 0.5s;
      }
      .alert.success {
        background: linear-gradient(135deg, #22c55e, #16a34a);
        color: white;
      }
      .alert.error {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        color: white;
      }
      .alert.show {
        display: block;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1><i class="fa-solid fa-house-lock"></i> Smart Home Security</h1>
      <p class="subtitle">
        AI-based Neural Network Model for Intruder Detection
      </p>

      <form method="POST" enctype="multipart/form-data">
        <div class="options">
          <label
            ><input type="radio" name="mode" value="search" checked /> üîç Verify
            Existing Face</label
          >
          <label
            ><input type="radio" name="mode" value="add" /> ‚ûï Add New
            Face</label
          >
        </div>

        <div id="nameBox">
          <input
            type="text"
            name="person_name"
            placeholder="Enter Person Name (optional)"
          />
        </div>

        <div class="upload-area" id="uploadArea">
          <i class="fa-solid fa-cloud-arrow-up"></i>
          <p id="uploadText">Drop your image here or click to browse</p>
          <p style="font-size: 0.9rem; color: #94a3b8">JPG / PNG (Max 5MB)</p>
          <input type="file" name="file" id="file" accept="image/*" required />
        </div>

        <button type="submit" id="submitBtn">Upload & Verify</button>
      </form>

      <div id="alertBox" class="alert"></div>

      <div class="preview" id="previewDiv" style="display: none">
        <img id="previewImg" src="" />
      </div>
    </div>

    {% if result %}
    <script id="server-data" type="application/json">
      {{ result | tojson }}
    </script>
    {% endif %}

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const radios = document.querySelectorAll('input[name="mode"]');
        const nameBox = document.getElementById("nameBox");
        const submitButton = document.getElementById("submitBtn");
        const alertBox = document.getElementById("alertBox");
        const previewDiv = document.getElementById("previewDiv");
        const previewImg = document.getElementById("previewImg");
        const fileInput = document.getElementById("file");
        const uploadText = document.getElementById("uploadText");
        const uploadArea = document.getElementById("uploadArea");

        alertBox.style.display = "none";
        previewDiv.style.display = "none";

        function updateButton(mode) {
          submitButton.innerHTML =
            mode === "add"
              ? '<i class="fa-solid fa-cloud-arrow-up"></i> Upload & Save'
              : '<i class="fa-solid fa-shield-halved"></i> Upload & Verify';
        }

        radios.forEach((r) => {
          r.addEventListener("change", () => {
            nameBox.style.display = r.value === "add" ? "block" : "none";
            updateButton(r.value);
          });
        });
        updateButton(
          document.querySelector('input[name="mode"]:checked').value
        );

        uploadArea.addEventListener("click", () => fileInput.click());

        fileInput.addEventListener("change", () => {
          if (fileInput.files && fileInput.files[0]) {
            uploadText.textContent = fileInput.files[0].name;
            const reader = new FileReader();
            reader.onload = function (e) {
              previewImg.src = e.target.result;
              previewDiv.style.display = "block";
            };
            reader.readAsDataURL(fileInput.files[0]);
          } else {
            uploadText.textContent = "Drop your image here or click to browse";
            previewDiv.style.display = "none";
          }
        });

        document.querySelector("form").addEventListener("submit", function () {
          const mode = document.querySelector(
            'input[name="mode"]:checked'
          ).value;
          alertBox.textContent =
            mode === "add"
              ? "‚è≥ Saving the uploaded image..."
              : "‚è≥ Verifying the uploaded image...";
          alertBox.className = "alert success show";
          alertBox.style.display = "block";
        });

        const serverScript = document.getElementById("server-data");
        const serverResult = serverScript
          ? JSON.parse(serverScript.textContent)
          : null;

        if (serverResult) {
          alertBox.textContent = serverResult.message || "";
          alertBox.className =
            "alert " + (serverResult.success ? "success" : "error") + " show";
          alertBox.style.display = "block";
          if (serverResult.image_url) {
            previewImg.src = serverResult.image_url;
            previewDiv.style.display = "block";
          }
        }
      });
    </script>
  </body>
</html>
